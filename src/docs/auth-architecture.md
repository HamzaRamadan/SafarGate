# ูุซููุฉ ุงูููุฏุณุฉ ุงููููุฉ: ุดุฌุฑุฉ ุงููุตุงุฏูุฉ ูุงูุชุณุฌูู ุงูููุญุฏุฉ (ARTA-002)

ูุฐุง ุงููุณุชูุฏ ูู ุงููุฑุฌุน ุงูุณูุงุฏู ุงูุฑุณูู ููุจููุฉ ุงููููุฉ ูุงููููููุฉ ูุนูููุฉ ุงูุฏุฎูู ูุงูุชุณุฌูู ุงูููุญุฏุฉ ูุฌููุน ุงูุฃุฏูุงุฑ (ูุณุงูุฑ ููุงูู) ูู ูุธุงู "ุณูุฑูุงุช"ุ ุจุงูุฅุถุงูุฉ ุฅูู ุจูุงุจุฉ ุงูุฏุฎูู ุงููุญุตูุฉ ูููุดุฑู.

---

### ุดุฌุฑุฉ ุงูุฑุณู ุงูุชููู (Technical Architecture Tree)

ูุฐุง ุงูุฑุณู ููุถุญ ุงููุณุงุฑ ุงูููุญุฏ ุงูุฐู ูุณููู ุงููุณุชุฎุฏู ููุฐ ูุญุธุฉ ูุตููู ูููุธุงู.

```
/ (ููุทุฉ ุงูุฏุฎูู ุงูุฃููู) -> [src/app/page.tsx]
โ
โโโ ๐ **ุงุฎุชูุงุฑ ุงูุฏูุฑ (ูุณุงูุฑ / ูุงูู)**
โ   โ   // ุชูุฌูู ุจุตุฑู ููุทุ ูุง ูุคุซุฑ ุนูู ุงูููุทู
โ   โโโ โก๏ธ REDIRECT TO -> /login
โ
โโโ ๐ช **ุจูุงุจุฉ ุงูุฏุฎูู ุงูููุญุฏุฉ** -> [src/app/login/page.tsx]
    โ
    โโโ โจ **ููุฒุฉ ุฌุงูุจูุฉ (Side Feature):**
    โ   โโโ ๐ฅ **ุนุฑุถ ูุงูุฐุฉ ุชุซุจูุช ุงูุชุทุจูู (PWA Install Prompt)**
    โ
    โโโ ๐ฑ **ุฅุฏุฎุงู ุฑูู ุงููุงุชู**
    โ   โโโ ๐ LOGIC: calls checkUserExistence(phoneNumber) -> [src/lib/simple-auth.ts]
    โ
    โโโ ๐ค **ูู ุงูุฑูู ููุฌูุฏุ**
    โ   โ
    โ   โโโ โ **ูุนู (ูุณุชุฎุฏู ุนุงุฆุฏ):**
    โ   โ   โโโ 1. Fetches user document.
    โ   โ   โโโ 2. Reads 'role' field.
    โ   โ   โโโ 3. [ุชูุฌูู ุฐูู]:
    โ   โ       โโโ role='carrier'  -> REDIRECT TO /carrier
    โ   โ       โโโ role='traveler' -> REDIRECT TO /dashboard
    โ   โ
    โ   โโโ โ **ูุง (ูุณุชุฎุฏู ุฌุฏูุฏ):**
    โ       โโโ 1. Show registration form (ุงูุงุณูุ ุชุญุฏูุฏ ุงูุฏูุฑ).
    โ       โโโ 2. LOGIC: calls registerNewUser(...) -> [src/lib/simple-auth.ts]
    โ       โโโ 3. Creates new user document in Firestore.
    โ       โโโ 4. [ุชูุฌูู ุฐูู]:
    โ           โโโ role='carrier'  -> REDIRECT TO /carrier (with Toast alert)
    โ           โโโ role='traveler' -> REDIRECT TO /dashboard
    โ
    โโโ ๐ก๏ธ **ููุนุฉ ุงููุดุฑู (Admin Citadel) - [ูุณุงุฑ ูููุตู]**
        โ
        โโโ ๐ **ุชุณุฌูู ุงูุฏุฎูู (Login)** -> [src/app/admin/login/page.tsx]
            โโโ ุงูููุทู:
                โโโ 1. calls signInWithEmail()
                โโโ 2. [ุชุญูู ูุฒุฏูุฌ]: Fetches user doc and validates role is 'admin' or 'owner'.

---

### ุงููููุงุช ุงูุณูุงุฏูุฉ ุงููุชุญููุฉ ุจุงูุนูููุฉ

*   **`src/lib/simple-auth.ts`**:
    *   **ุงููุธููุฉ:** ูู ุงูุนูู ุงููุฏุจุฑ ุงูููุญุฏ ูุนูููุฉ ุงูุฏุฎูู. ูุญุชูู ุนูู ุงูุฏูุงู ุงูุฃุณุงุณูุฉ:
        *   `checkUserExistence`: ููุจุญุซ ุนู ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุนุจุฑ ุงููุงุชู.
        *   `registerNewUser`: ูุฅูุดุงุก ููู ูุณุชุฎุฏู ุฌุฏูุฏ ููุณุชุฎุฏูู ุงููุงุชู.
        *   `initiateEmailSignUp` & `signInWithEmail`: ูุชุณุฌูู ูุฏุฎูู ูุณุชุฎุฏูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุงููุดุฑููู).
        *   `initiateGoogleSignIn`: ูุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ ุฌูุฌู.

*   **`src/app/login/page.tsx`**:
    *   **ุงููุธููุฉ:** ูู ููุทุฉ ุงูุชูุงุนู ุงููุญูุฏุฉ ูููุณุชุฎุฏู ุงูุนุงุฏู (ูุณุงูุฑ/ูุงูู).

*   **`firestore.rules`**:
    *   **ุงููุธููุฉ:** ูุนูู ูุญุงุฑุณ ุฃููู ููุงุนุฏุฉ ุงูุจูุงูุงุช.

*   **`src/hooks/use-user-profile.ts`**:
    *   **ุงููุธููุฉ:** ูููู ุจุฌูุจ ููู ุชุนุฑูู ุงููุณุชุฎุฏู ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู.

