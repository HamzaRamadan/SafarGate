
# ุงูุชูุฑูุฑ ุงูุฌูุงุฆู ูุจุฑูุชูููู ููู ุงูุฑูุงุจ (AIAR-009)

ูุฐุง ุงูุชูุฑูุฑ ูู ูุชูุฌุฉ ุงููุญุต ุงููุนููู ูุขููุฉ ููู ุฑุญูุฉ ูุคูุฏุฉ ุจุฑูุงุจูุง ูู ูุงูู ุฅูู ุขุฎุฑ ูู ุญุงูุฉ ุงูุทูุงุฑุฆ.

---

### 1. ุดุฌุฑุฉ ุงูุฑุณู ุงูุชููู: ูุณุงุฑ ุนูููุฉ ุงูููู

```
/carrier/trips (ุฑุญูุงุชู)
โ
โโโ ๐จโโ๏ธ **ุงููุงูู 1 (ุงูุฃุตูู): ููุงุฌู ุธุฑูุงู ุทุงุฑุฆุงู**
    โ
    โโโ 1. **ุงูุดุฑุท:** ุฑุญูุฉ ูุคูุฏุฉ (`status: 'Planned'`) ูุชุญุชูู ุนูู ุฑูุงุจ.
    โ
    โโโ 2. **ุงูุฅุฌุฑุงุก:** ูุถุบุท ุนูู ุฒุฑ "ููู ุงูุฑูุงุจ" ๐ ูู ุจุทุงูุฉ ุงูุฑุญูุฉ.
    โ   โโโ โ๏ธ **ุงููุญุฑู:** `my-trips-list.tsx`
    โ
    โโโ 3. **ุงูุงุฎุชูุงุฑ:** ุชูุชุญ ูุงูุฐุฉ `TransferRequestDialog`.
    โ   โ   โโโ ุฃ. ูููู ุงููุธุงู ุจููุชุฑุฉ ูุนุฑุถ ุงููุงูููู ุงูุฐูู ูุนูููู ุนูู ููุณ ุงููุณุงุฑ.
    โ   โ   โโโ ุจ. ูุฎุชุงุฑ ุงููุงูู 1 "ุงููุงูู 2" ูุจุฏูู.
    โ
    โโโ 4. **ุฅูุดุงุก ุงูุทูุจ:**
        โ   โโโ โ๏ธ **ุงููุญุฑู:** `transfer-request-dialog.tsx` -> `addDocumentNonBlocking()`
        โโโ โก๏ธ **ุงููุชูุฌุฉ:** ุฅูุดุงุก ูุซููุฉ ุฌุฏูุฏุฉ ูู `/transferRequests` ุจุงูุญุงูุฉ `pending`.

/carrier/bookings (ุตูุฏูู ุงููุงุฑุฏ ูููุงูู ุงูุจุฏูู)
โ
โโโ ๐ต๏ธ **ุงููุงูู 2 (ุงูุจุฏูู): ูุณุชูุจู ุงูุทูุจ**
    โ
    โโโ 5. **ุงูุฅุดุนุงุฑ:** (ููุทุฉ ุถุนู 1) ููุชุฑุถ ุฃู ุชุตูู ุฅุดุนุงุฑ ููุฑู ุจุงูุทูุจ.
    โ
    โโโ 6. **ุงููุฑุงุฑ:** ูุฑู ุงูุทูุจ ูู "ุตูุฏูู ุงููุงุฑุฏ" ุนุจุฑ ุจุทุงูุฉ `TransferRequestCard`.
    โ
    โโโ 7. **[ูุจูู ุงูุทูุจ]:** ูุถุบุท ุนูู ุฒุฑ "ูุจูู ุงุณุชูุงู ุงูุฑุญูุฉ".

/functions/src/index.ts (ุงูุนูู ุงูุณุญุงุจู ุงููุฏุจุฑ)
โ
โโโ โ๏ธ **ุงููุญุฑู ุงูุฐุฑู (Cloud Function - ููุทุฉ ุถุนู 2): ูุฌุจ ุฃู ูููู ุจุชูููุฐ `runTransaction`**
    โ
    โโโ 8. **ุชุญุฏูุซ ุงูุฑุญูุฉ ุงูุฃุตููุฉ:** `carrierId` -> `uid` ุงููุงูู 2.
    โ
    โโโ 9. **ุชุญุฏูุซ ุงูุญุฌูุฒุงุช:** [ุญููุฉ ุดุงููุฉ] ุนูู ูู `booking` ูุฑุชุจุท ุจุงูุฑุญูุฉ ูุชุบููุฑ `carrierId`.
    โ
    โโโ 10. **ุชุญุฏูุซ ุทูุจ ุงูููู:** `status` -> `accepted`.
    โ
    โโโ 11. **ุฅุนุงุฏุฉ ุชูุฌูู ุงูุฃููุงู:** (ููุทุฉ ุถุนู 3) ุชูุซูู ุญู ุงููุงูู 2 ูู "ุงูุนุฑุจูู" ุงููุณุชูู.
    โ
    โโโ 12. **ุฅุบูุงู ูุชุฃุณูุณ ูููุงุช ุงูุงุชุตุงู:** (ููุทุฉ ุถุนู 4)
    โ   โ   โโโ ุฃ. ุฅุบูุงู ุงูุฏุฑุฏุดุฉ ุงูุฌูุงุนูุฉ ุงููุฏููุฉ.
    โ   โ   โโโ ุจ. ุฅูุดุงุก ุฏุฑุฏุดุฉ ุฌูุงุนูุฉ ุฌุฏูุฏุฉ ูุน ุงููุงูู 2.
    โ
    โโโ 13. **ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุดุงููุฉ:**
        โ   โโโ ุฃ. ุฅุดุนุงุฑ ููู ูุณุงูุฑ ุจุงูุชุบููุฑ ุงูุทุงุฑุฆ ูุจูุงูุงุช ุงููุงูู ุงูุฌุฏูุฏ.
        โ   โโโ ุจ. ุฅุดุนุงุฑ ูููุงูู 1 ุจุชุฃููุฏ ูุฌุงุญ ุนูููุฉ ุงูููู.

---

### 2. ุงูุชุญููู ุงูุดูููู ูููุงุทู ุงูุถุนู

1.  **ุงูููุฉ:** ูุฌูุฏ ุงูุขููุฉ ุจุญุฏ ุฐุงุชูุง ูู ููุฉุ ุญูุซ ูููุฑ ุญูุงู ููุญุงูุงุช ุงูุทุงุฑุฆุฉ ููุญุงูุธ ุนูู ุงุณุชูุฑุงุฑูุฉ ุงูุฎุฏูุฉ.

2.  **ุงูุถุนู ุงููุงุชู (1) - ูุฌูุฉ ุงูุฅุดุนุงุฑ:** ุงููุธุงู ุงูุญุงูู ูุนุชูุฏ ุนูู ุฃู ุงููุงูู 2 ุณููุชุญ ุงูุชุทุจูู ููุฑู ุงูุทูุจ ุจุงูุตุฏูุฉ. **ูุง ููุฌุฏ ูุญุฑู ุณุญุงุจู** ูุณุชูุน ูุฅูุดุงุก ุทูุจุงุช ุงูููู ููุฑุณู ุฅุดุนุงุฑุงู ููุฑูุงูุ ููุง ูุฌุนู ุงูุนูููุฉ ุจุทูุฆุฉ ูุบูุฑ ููุซููุฉ.

3.  **ุงูุถุนู ุงููุงุชู (2) - ุบูุงุจ ุงููุญุฑู ุงูุฐุฑู:** ุนูููุฉ ุงููุจูู ุงูุญุงููุฉ ุชุชู ุนูู ุงูุฃุบูุจ ูู ุทุฑู ุงูุนููู (Frontend)ุ ููุฐุง **ูุญุธูุฑ ุชูุงูุงู** ูู ุนูููุฉ ูุนูุฏุฉ ููุฐู. ุฅุฐุง ุงููุทุน ุงูุฅูุชุฑูุช ุจุนุฏ ุชุญุฏูุซ ูุซููุฉ ูุงุญุฏุฉุ ุณูุชูู ุงููุธุงู ุจุงููุงูู. **ูุฌุจ** ุฃู ุชุชู ุงูุนูููุฉ ุจุงููุงูู ุฏุงุฎู `Cloud Function` ุชุถูู ุฅูุง ูุฌุงุญ ูู ุงูุฎุทูุงุช ุฃู ูุดููุง ุฌููุนุงู.

4.  **ุงูุถุนู ุงููุงุชู (3) - ุงูุซูุจ ุงููุงูู ุงูุฃุณูุฏ:** ูุฐู ูู ุงููุงุฑุซุฉ. ุงููุณุงูุฑ ุฏูุน ุงูุนุฑุจูู ูููุงูู 1. ุนูุฏูุง ููุจู ุงููุงูู 2 ุงูุฑุญูุฉุ ูู ูุถูู ุญูู ุงููุงูู ูู ูุฐุง ุงูุนุฑุจููุ ุงููุธุงู ุงูุญุงูู **ูุง ูุนุงูุฌ ูุฐู ุงูููุทุฉ ุฅุทูุงูุงู**. ุงูุนุฑุจูู ูุจูู ูุณุฌูุงู ุจุงุณู ุงููุงูู 1ุ ููุง ูุฎูู ูุฒุงุนุงู ูุงููุงู ูุคูุฏุงู.

5.  **ุงูุถุนู ุงููุงุชู (4) - ููุถู ุงูุงุชุตุงูุงุช:** ุจุนุฏ ููู ุงูุฑุญูุฉุ ูุจูู ุงููุณุงูุฑูู ูู ุงูุฏุฑุฏุดุฉ ุงููุฏููุฉ ูุน ุงููุงูู 1 ุงูุฐู ูู ูุนุฏ ูู ุนูุงูุฉ ุจุงูุฑุญูุฉ. **ูุฌุจ** ุนูู ุงููุธุงู ุฃู ูููู ุขููุงู ุจุฅุบูุงู ุงูุฏุฑุฏุดุฉ ุงููุฏููุฉ ุจุฑุณุงูุฉ ูุธุงูุ ูุฅูุดุงุก ุฏุฑุฏุดุฉ ุฌุฏูุฏุฉุ ูุฅุถุงูุฉ ุฌููุน ุงูุฑูุงุจ ูุน ุงููุงูู ุงูุฌุฏูุฏ.

---

### 3. ุญุงูุฉ ุงูุจุทุงูุงุช ุจุนุฏ ุงูููู (ุงูุชุตูุฑ ุงูุตุญูุญ)

*   **ุจุทุงูุฉ ุงููุณุงูุฑ:** ูู ุตูุญุฉ `history`ุ ูุฌุจ ุฃู ูุฑู ุงููุณุงูุฑ ููุณ ุงูุชุฐูุฑุฉุ ูููู ุจูุงูุงุช ุงููุงูู (ุงูุงุณูุ ุงูุตูุฑุฉุ ุฑูู ุงููุงุชู) ูุฏ ุชุบูุฑุช **ุชููุงุฆูุงู** ุฅูู ุจูุงูุงุช ุงููุงูู 2. ูุฌุจ ุฃู ูุธูุฑ ูู ุฅุดุนุงุฑ ูุงุถุญ ูููุฏ ุจุญุฏูุซ ุงูุชุบููุฑ.
*   **ุจุทุงูุฉ ุงููุงูู 1 (ุงูุฃุตูู):** ุงูุฑุญูุฉ ูุฌุจ ุฃู ุชุฎุชูู ูู ูุงุฆูุฉ "ุฑุญูุงุชู"ุ ูุชุธูุฑ ูู "ุงูุฃุฑุดูู" ุจุญุงูุฉ ุฌุฏูุฏุฉ ูุซู "ุชู ููููุง" (Transferred).
*   **ุจุทุงูุฉ ุงููุงูู 2 (ุงูุฌุฏูุฏ):** ุงูุฑุญูุฉ ูุฌุจ ุฃู ุชุธูุฑ ูู ูุงุฆูุฉ "ุฑุญูุงุชู" ูุฏูู ูุฃู ุฑุญูุฉ ุนุงุฏูุฉ ุฃุฎุฑู ูู ูุณุคูู ุนููุง.

---

### 4. ุฎุทุฉ ุงููุนุงูุฌุฉ ุงูููุชุฑุญุฉ (ูุฃูุฑ ูุณุชูุจูู)

ุจูุงุกู ุนูู ูุฐุง ุงูุชุดุฑูุญุ ูุง ูููู ุชูููุฐ ุฃู ููุฏ ุญุงููุงู. ุงูุฎุทุฉ ูุฌุจ ุฃู ุชููู:
1.  **ุฅูุดุงุก ูุธููุฉ ุณุญุงุจูุฉ `onTransferRequestCreated`:** ูุฅุฑุณุงู ุฅุดุนุงุฑ ููุฑู ูููุงูู ุงูุจุฏูู.
2.  **ุฅูุดุงุก ูุธููุฉ ุณุญุงุจูุฉ `onTransferRequestUpdated`:** ูุชูููุฐ "ุงููุญุฑู ุงูุฐุฑู" ุนูุฏ ูุจูู ุงูุทูุจุ ููุนุงูุฌุฉ ุชุญุฏูุซ ุฌููุน ุงููุซุงุฆูุ ูุชุณููุฉ ุงูุฃููุฑ ุงููุงููุฉุ ูุฅุฏุงุฑุฉ ูููุงุช ุงูุฏุฑุฏุดุฉุ ูุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช ุงูุดุงููุฉ.
3.  **ุชุนุฏูู ูุงุฌูุฉ ุงููุณุชุฎุฏู** ููุชุนุงูู ูุน ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ "Transferred".

**ุงูุฎูุงุตุฉ:** ุงูุจุฑูุชูููู ุงูุญุงูู ูู ูุฌุฑุฏ "ูููู ุนุธูู" ููุชูุฑ ุฅูู "ุงูุฌูุงุฒ ุงูุนุตุจู" ู "ุงูุฏูุฑุฉ ุงูุฏูููุฉ". ุฅูู ุบูุฑ ุตุงูุญ ููุชูููุฐ ูู ุจูุฆุฉ ุงูุฅูุชุงุฌ.
